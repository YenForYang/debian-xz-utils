<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XZ Utils: xz/signals.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XZ Utils
   &#160;<span id="projectnumber">5.2.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53e01eec41348db90f08d9ee7e6793af.html">xz</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">signals.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Handling signals to abort operation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="private_8h.html">private.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae710b6e1e3475f05843032f73a4dd7a7"><td class="memItemLeft" align="right" valign="top"><a id="ae710b6e1e3475f05843032f73a4dd7a7"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><b>signal_handler</b> (int sig)</td></tr>
<tr class="separator:ae710b6e1e3475f05843032f73a4dd7a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3719a1754f6e317bbb96770b973d453c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#a3719a1754f6e317bbb96770b973d453c">signals_init</a> (void)</td></tr>
<tr class="separator:a3719a1754f6e317bbb96770b973d453c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c7cbcd4595590670a3784d393770693"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#a6c7cbcd4595590670a3784d393770693">signals_block</a> (void)</td></tr>
<tr class="separator:a6c7cbcd4595590670a3784d393770693"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55ea2250ff5153a3a4daf1f5a75ea921"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#a55ea2250ff5153a3a4daf1f5a75ea921">signals_unblock</a> (void)</td></tr>
<tr class="memdesc:a55ea2250ff5153a3a4daf1f5a75ea921"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unblock the signals blocked by <a class="el" href="signals_8h.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a>.  <a href="#a55ea2250ff5153a3a4daf1f5a75ea921">More...</a><br /></td></tr>
<tr class="separator:a55ea2250ff5153a3a4daf1f5a75ea921"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb960c3705a055f596b288b0961e135a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#abb960c3705a055f596b288b0961e135a">signals_exit</a> (void)</td></tr>
<tr class="separator:abb960c3705a055f596b288b0961e135a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a190aaf6ae9eaa75671718e1ceed999e6"><td class="memItemLeft" align="right" valign="top">volatile sig_atomic_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#a190aaf6ae9eaa75671718e1ceed999e6">user_abort</a> = false</td></tr>
<tr class="separator:a190aaf6ae9eaa75671718e1ceed999e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32f31d825b75591d947a03750cdedda1"><td class="memItemLeft" align="right" valign="top">static volatile sig_atomic_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#a32f31d825b75591d947a03750cdedda1">exit_signal</a> = 0</td></tr>
<tr class="separator:a32f31d825b75591d947a03750cdedda1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad26b98f4795fd915cf1a761dc572f590"><td class="memItemLeft" align="right" valign="top">static sigset_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#ad26b98f4795fd915cf1a761dc572f590">hooked_signals</a></td></tr>
<tr class="separator:ad26b98f4795fd915cf1a761dc572f590"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43e552d0c019958f2cab258d14d99a09"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#a43e552d0c019958f2cab258d14d99a09">signals_are_initialized</a> = false</td></tr>
<tr class="separator:a43e552d0c019958f2cab258d14d99a09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31d411d04c87eedc3fb64f7c4478d1d3"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="signals_8c.html#a31d411d04c87eedc3fb64f7c4478d1d3">signals_block_count</a> = 0</td></tr>
<tr class="memdesc:a31d411d04c87eedc3fb64f7c4478d1d3"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="signals_8c.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a> and <a class="el" href="signals_8c.html#a55ea2250ff5153a3a4daf1f5a75ea921" title="Unblock the signals blocked by signals_block(). ">signals_unblock()</a> can be called recursively.  <a href="#a31d411d04c87eedc3fb64f7c4478d1d3">More...</a><br /></td></tr>
<tr class="separator:a31d411d04c87eedc3fb64f7c4478d1d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handling signals to abort operation. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a3719a1754f6e317bbb96770b973d453c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3719a1754f6e317bbb96770b973d453c">&#9670;&nbsp;</a></span>signals_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void signals_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the signal handler, which will set user_abort to true when user e.g. presses C-c. </p>

<p class="reference">References <a class="el" href="signals_8c.html#ad26b98f4795fd915cf1a761dc572f590">hooked_signals</a>.</p>

</div>
</div>
<a id="a6c7cbcd4595590670a3784d393770693"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c7cbcd4595590670a3784d393770693">&#9670;&nbsp;</a></span>signals_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void signals_block </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Block the signals which don't have SA_RESTART and which would just set user_abort to true. This is handy when we don't want to handle EINTR and don't want SA_RESTART either. </p>

<p class="reference">References <a class="el" href="signals_8c.html#a43e552d0c019958f2cab258d14d99a09">signals_are_initialized</a>, and <a class="el" href="signals_8c.html#a31d411d04c87eedc3fb64f7c4478d1d3">signals_block_count</a>.</p>

<p class="reference">Referenced by <a class="el" href="file__io_8h.html#a51c7b0ad8b7829773a69972565b7d08d">io_open_dest()</a>, <a class="el" href="file__io_8h.html#ac4fb03f340ee03676cbde913682a3719">io_open_src()</a>, and <a class="el" href="message_8h.html#abc7b1a649494177507246554d2d6d6ef">message_progress_update()</a>.</p>

</div>
</div>
<a id="a55ea2250ff5153a3a4daf1f5a75ea921"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55ea2250ff5153a3a4daf1f5a75ea921">&#9670;&nbsp;</a></span>signals_unblock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void signals_unblock </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unblock the signals blocked by <a class="el" href="signals_8h.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a>. </p>

<p class="reference">References <a class="el" href="signals_8c.html#a43e552d0c019958f2cab258d14d99a09">signals_are_initialized</a>.</p>

<p class="reference">Referenced by <a class="el" href="file__io_8h.html#ac4fb03f340ee03676cbde913682a3719">io_open_src()</a>.</p>

</div>
</div>
<a id="abb960c3705a055f596b288b0961e135a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb960c3705a055f596b288b0961e135a">&#9670;&nbsp;</a></span>signals_exit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void signals_exit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If user has sent us a signal earlier to terminate the process, re-raise that signal to actually terminate the process. </p>

<p class="reference">References <a class="el" href="signals_8c.html#a32f31d825b75591d947a03750cdedda1">exit_signal</a>, and <a class="el" href="main_8c.html#aa5da9e106c96aef50fcb212123d5e906">set_exit_status()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a190aaf6ae9eaa75671718e1ceed999e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a190aaf6ae9eaa75671718e1ceed999e6">&#9670;&nbsp;</a></span>user_abort</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile sig_atomic_t user_abort = false</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If this is true, we will clean up the possibly incomplete output file, return to main() as soon as practical. That is, the code needs to poll this variable in various places. </p>

<p class="reference">Referenced by <a class="el" href="coder_8c.html#ae31acd560ee4d35b7bd0d1bdc94fde0a">coder_passthru()</a>, and <a class="el" href="file__io_8c.html#a6bec7737c5b829039195bd8e12d447e0">io_wait()</a>.</p>

</div>
</div>
<a id="a32f31d825b75591d947a03750cdedda1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32f31d825b75591d947a03750cdedda1">&#9670;&nbsp;</a></span>exit_signal</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile sig_atomic_t exit_signal = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>If we were interrupted by a signal, we store the signal number so that we can raise that signal to kill the program when all cleanups have been done. </p>

<p class="reference">Referenced by <a class="el" href="signals_8h.html#abb960c3705a055f596b288b0961e135a">signals_exit()</a>.</p>

</div>
</div>
<a id="ad26b98f4795fd915cf1a761dc572f590"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad26b98f4795fd915cf1a761dc572f590">&#9670;&nbsp;</a></span>hooked_signals</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">sigset_t hooked_signals</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Mask of signals for which have have established a signal handler to set user_abort to true. </p>

<p class="reference">Referenced by <a class="el" href="signals_8h.html#a3719a1754f6e317bbb96770b973d453c">signals_init()</a>.</p>

</div>
</div>
<a id="a43e552d0c019958f2cab258d14d99a09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43e552d0c019958f2cab258d14d99a09">&#9670;&nbsp;</a></span>signals_are_initialized</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool signals_are_initialized = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>True once <a class="el" href="signals_8c.html#a3719a1754f6e317bbb96770b973d453c">signals_init()</a> has finished. This is used to skip blocking signals (with uninitialized hooked_signals) if <a class="el" href="signals_8c.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a> and <a class="el" href="signals_8c.html#a55ea2250ff5153a3a4daf1f5a75ea921" title="Unblock the signals blocked by signals_block(). ">signals_unblock()</a> are called before <a class="el" href="signals_8c.html#a3719a1754f6e317bbb96770b973d453c">signals_init()</a> has been called. </p>

<p class="reference">Referenced by <a class="el" href="signals_8h.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a>, and <a class="el" href="signals_8h.html#a55ea2250ff5153a3a4daf1f5a75ea921">signals_unblock()</a>.</p>

</div>
</div>
<a id="a31d411d04c87eedc3fb64f7c4478d1d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31d411d04c87eedc3fb64f7c4478d1d3">&#9670;&nbsp;</a></span>signals_block_count</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t signals_block_count = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="signals_8c.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a> and <a class="el" href="signals_8c.html#a55ea2250ff5153a3a4daf1f5a75ea921" title="Unblock the signals blocked by signals_block(). ">signals_unblock()</a> can be called recursively. </p>

<p class="reference">Referenced by <a class="el" href="signals_8h.html#a6c7cbcd4595590670a3784d393770693">signals_block()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
